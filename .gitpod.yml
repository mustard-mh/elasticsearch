image:
  file: .gitpod.Dockerfile

tasks:
- name: Init cluster workspace
  before: |
    mkdir -p /workspace/.gradle
    printf "org.gradle.jvmargs=-Xmx6g\norg.gradle.daemon=true\n" > /workspace/.gradle/gradle.properties
  # init: |
  #   ./gradlew compileAll -PfetchGwt
  #   ./gradlew ideImport
  #   cd ui/angular/angular.server && yarn install; cd -
  init: |
    if [[ "$GITPOD_HEADLESS" != "true" ]]; then echo "No prebuild, skipping init task."; exit 0; fi
    ./gradlew localDistro

jetbrains:
  intellij:
    vmoptions: '-Dshared.indexes.download=false -Xmx8g -XX:+UnlockDiagnosticVMOptions -XX:ErrorFile=/workspace/.gitpod/hs_err_pid%p.log -XX:+ExtensiveErrorReports -XX:+HeapDumpOnOutOfMemoryError -XX:HeapDumpPath=/workspace/.gitpod/java_pid%p.hprof'
    prebuilds:
      version: stable
    plugins:
      - CheckStyle-IDEA
      - intellij.prettierJS
      #- org.sonarlint.idea
      - EclipseCodeFormatter
      - com.jetbrains.performancePlugin.yourkit
